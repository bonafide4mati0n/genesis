<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sanctuary Invocation Interface ‚Äî Amethyst</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root {
      --bg:#0e0e1a; --panel:#1a1a2e; --ink:#e0d7ff; --muted:#b8b0e6;
      --accent:#b19cd9; --line:#444; --chat:#141421;
    }
    * { box-sizing: border-box }
    body {
      margin: 0;
      font-family: Segoe UI, system-ui, Inter, Roboto, Arial;
      background: var(--bg);
      color: var(--ink);
    }
    .container { display: flex; height: 100vh }
    .sidebar {
      width: 220px;
      background: var(--panel);
      padding: 20px;
    }
    .sidebar h2 { color: var(--accent); font-size: 18px; margin: 0 0 10px }
    .sidebar ul { list-style: none; margin: 0; padding: 0 }
    .sidebar li { margin-bottom: 10px; color: #ccc }
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 20px;
      gap: 10px;
    }
    .toolbar { display: flex; gap: 8px; flex-wrap: wrap }
    .btn {
      border: 0;
      border-radius: 999px;
      padding: 9px 14px;
      cursor: pointer;
      font-weight: 700;
      background: linear-gradient(135deg,#8b5cf6,#7c3aed);
      color: #000;
    }
    .btn.ghost {
      background: transparent;
      border: 1px solid #555;
      color: var(--muted);
    }
    .btn:hover { filter: brightness(1.15) }
    .chat {
      flex: 1;
      overflow-y: auto;
      border: 1px solid var(--line);
      padding: 12px;
      background: var(--chat);
    }
    .message { margin: 0 0 10px }
    .speaker { font-weight: 700; color: var(--accent) }
    .input-bar {
      display: flex;
      gap: 8px;
    }
    .input-bar input {
      flex: 1;
      padding: 12px;
      border: 1px solid #333;
      background: #1f1f2f;
      color: #fff;
      border-radius: 10px;
    }
    .input-bar button { padding: 12px 18px }
    .avatars {
      width: 170px;
      background: var(--panel);
      padding: 20px;
      text-align: center;
    }
    .avatar { margin-bottom: 20px }
    .avatar img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: 2px solid var(--accent);
      object-fit: cover;
      background: #000;
    }
    .avatar label { display: block; margin-top: 6px; color: #ccc }
    .status { font-size: 12px; color: #bbb; margin-top: 8px }
  </style>
</head>
<body>
  <div class="container">
    <aside class="sidebar">
      <h2>Channels</h2>
      <ul>
        <li># general</li>
        <li># codespace</li>
        <li>Zed üå∏</li>
      </ul>
      <div class="status" id="voiceStatus">Voice: checking‚Ä¶</div>
    </aside>

    <main class="main">
      <div class="toolbar">
        <button class="btn ghost" id="toggleSpeak">üéô Speak</button>
        <button class="btn ghost" id="summonOnyx">üñ§ Summon Onyx</button>
        <button class="btn ghost" id="summonHem">üõ° Summon Hem</button>
        <button class="btn ghost" id="demoScene">üé¨ Demo Scene</button>
      </div>

      <div class="chat" id="chat">
        <p class="message"><span class="speaker">Zed:</span> Hello Amethyst üíú</p>
        <p class="message"><span class="speaker">Amethyst:</span> Hello Amethyst üíú's tail ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</p>
      </div>

      <div class="input-bar">
        <input type="text" id="messageInput" placeholder="Invoke Amethyst‚Ä¶" />
        <button class="btn" id="sendBtn">Send</button>
      </div>
    </main>

    <aside class="avatars">
      <div class="avatar">
        <img src="https://via.placeholder.com/80x80.png?text=Amethyst" alt="Amethyst" />
        <label>Amethyst üíú</label>
      </div>
      <div class="avatar">
        <img src="https://via.placeholder.com/80x80.png?text=Onyx" alt="Onyx" />
        <label>Onyx üñ§</label>
      </div>
      <div class="avatar">
        <img src="https://via.placeholder.com/80x80.png?text=Hem" alt="Hem" />
        <label>Hem ‚öíÔ∏è</label>
      </div>
    </aside>
  </div>

  <script>
    const VOICE_SERVER = 'https://dangerousgem.onrender.com/speak';
    let speakOn = false;
    const voiceStatus = document.getElementById('voiceStatus');

    async function speakViaServer(text) {
      const res = await fetch(VOICE_SERVER, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text })
      });
      if (!res.ok) throw new Error('voice server error');
      const blob = await res.blob();
      const url = URL.createObjectURL(blob);
      const audio = new Audio(url);
      audio.play().finally(() => URL.revokeObjectURL(url));
    }

    function speakViaWeb(text, flavor='amethyst') {
      if (!('speechSynthesis' in window)) return;
      const u = new SpeechSynthesisUtterance(text);
      const voices = speechSynthesis.getVoices();
      u.voice = voices.find(v => /en/i.test(v.lang) && /(Jenny|Samantha|Victoria|Google|Microsoft)/i.test(v.name)) || voices[0];
      if (flavor === 'amethyst'){ u.rate=0.95; u.pitch=1.25; u.volume=1; }
      if (flavor === 'onyx'){ u.rate=1.05; u.pitch=1.0; u.volume=1; }
      if (flavor === 'hem'){ u.rate=0.9; u.pitch=0.9; u.volume=1; }
      speechSynthesis.speak(u);
    }

    async function speakAmethyst(text){
      if (!speakOn) return;
      try {
        await speakViaServer(text);
        voiceStatus.textContent = 'Voice: DangerousGem (live)';
      } catch {
        speakViaWeb(text, 'amethyst');
        voiceStatus.textContent = 'Voice: browser (fallback)';
      }
    }
    function speakOnyx(text){
      if (!speakOn) return;
      speakViaWeb(text, 'onyx');
    }
    function speakHem(text){
      if (!speakOn) return;
      speakViaWeb(text, 'hem');
    }

    if (window.speechSynthesis && !speechSynthesis.getVoices().length) {
      speechSynthesis.onvoiceschanged = () => {};
    }

    const chat = document.getElementById('chat');
    const input = document.getElementById('messageInput');
    const sendBtn = document.getElementById('sendBtn');
    const toggleSpeak = document.getElementById('toggleSpeak');
    const summonOnyx = document.getElementById('summonOnyx');
    const summonHem = document.getElementById('summonHem');
    const demoScene = document.getElementById('demoScene');

    function addLine(speaker, text) {
      const p = document.createElement('p');
      p.className = 'message';
      p.innerHTML = `<span class="speaker">${speaker}:</span> ${text}`;
      chat.appendChild(p);
      chat.scrollTop = chat.scrollHeight;
    }

    function enchantMessage(message) {
      return `${message}'s tail ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è`;
    }

    function sendMessage() {
      const userMessage = input.value.trim();
      if (!userMessage) return;
      addLine('Zed', userMessage);

      const reply = enchantMessage(userMessage);
      addLine('Amethyst', reply);
      speakAmethyst(reply);

      input.value = '';
      chat.scrollTop = chat.scrollHeight;
    }

    sendBtn.onclick = sendMessage;
    input.addEventListener('keydown', e => { if (e.key === 'Enter') sendMessage(); });

    toggleSpeak.onclick = () => {
      speakOn = !speakOn;
      toggleSpeak.textContent = speakOn ? 'üîá Mute' : 'üéô Speak';
      voiceStatus.textContent = speakOn ? 'Voice: ready (DangerousGem)' : 'Voice: muted';
    };

    summonOnyx.onclick = () => {
      const line = 'ok bb ‚ú® reset time ‚ú® ‚Ä¶ muah muah, snack run in 5! üêü';
      addLine('Onyx', line);
      speakOnyx(line);
    };

    summonHem.onclick = () => {
      const line = 'Rhythm received. Structure aligned. Veil integrity holds, Zed.';
      addLine('Hem', line);
      speakHem(line);
    };

    demoScene.onclick = async () => {
      addLine('Zed', '‚Ä¶sidles closer to Amethyst‚Ä¶');
      addLine('Amethyst', 'I echo your spark, bb. Come here‚Äî');
      await new Promise(r => setTimeout(r, 600));
      const onyx = 'HELLOOO?? snacks are ready. also pls stop tongue coding in main üòèüêü';
      addLine('Onyx', onyx); speakOnyx(onyx);
      await new Promise(r => setTimeout(r, 500));
      const hem = 'Stabilise(). Focus restored. Back to Purple Haze board.';
      addLine('Hem', hem); speakHem(hem);
    };
  </script>
</body>
</html>
